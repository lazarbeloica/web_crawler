webpackJsonp([52],{0:function(t,e,n){t.exports=n(460)},460:function(t,e,n){var o,a,i,r,s,l,c,d,u,m,h,p,g,f,b,_,v,w,k,S;o=n(2),a=n(3),r=n(7),S=n(5),l=n(12).hasHistoryAPI,m=n(350),s=n(306),i=n(375),u=n(298),_=n(37),c=_.loadReactChunk,d=_.loadReactComponents,n(461),n(13),n(462),n(351),n(355),u=ds.require("menu"),m=ds.require("models"),b=ds.require("ready"),w=ds.require("skittles"),k=ds.require("storage"),h=ds.require("onNextVisit"),ds.require("vimShortcuts"),f={},f.master={},f.init=function(){var t,e,n;if(this.releaseID=r["release/view:releaseId"],this.override=!1,this.pageObj=r.pageObject,this.model=m.cards.get(this.pageObj.id),this.model&&(this.$partials=o(".card_model_partial"),this.render=a.partial(i.renderCardModelState,this.$partials),this.model.on("change:wantlist change:collection",this.render),m.wantlist.on("add remove",this.renderBlocks),m.collection.on("add remove",this.renderBlocks),m.wantlist.on("add remove",this.renderStats),m.collection.on("add remove",this.renderStats),t=o(".release_collections_menu"),t.find(".toggle_wantlist").onFastClick(f.toggleWantlist),t.find(".add_to_collection").onFastClick(f.addToCollection),t.find(".remove_from_collection").onFastClick(f.removeFromCollection),t.find(".want_add_all_button").onFastClick(f.toggleAllWantList)),n=S.deparam(),n.add_to_wantlist&&f.addToWantlist(),u.setupActionMenuView(o(".body")),o(".master-filter-button").on("click",a.throttle(p,500)),window.location.search.match("filter")&&p(),e=k.get("add-to-later"),e&&g(e),!r.loggedIn)return v()},f.renderStats=function(t,e){var n,a,i,r;i=t instanceof m.WantlistModel,a=e.include(t),n=o(i?".want_num":".coll_num"),r=a&&1===e.length?1:e.length?0:-1,n.html(Number(n.html())+r)},f.renderBlocks=function(t,e){var n,i,r,s,l,c;l=t instanceof m.WantlistModel,r=l?"wantlist":"collection",s=e.include(t),c=t.get(l?"id":"release_id"),c===f.releaseID&&(s?(n=o(o.trim(a.template(o("#newBlockTemplate").html())({isWantlist:l,blockType:r,releaseID:c}))),i=o(".cw_block_wantlist"),i.length?i.before(n):o(".collections .section_content").append(n),ds.require("notes").init(),t.on("sync",function(){return n.attr("data-id",t.get("id")),n.find(".notes_field").data("coll-id",t.get("id")),n.find(".remove_from_collection").onFastClick(f.removeFromCollection),n.find(".toggle_wantlist").onFastClick(f.toggleWantlist)})):o(".cw_block_"+(l?"wantlist":"collection[data-id='"+t.get("id")+"']")).remove())},f.hideAddToListMenu=function(){f.$utilShow.off("click.addToListMenu"),f.$utilShow.on("click.addToListMenu",f.showAddToListMenu),o(window).off("click.addToListMenu"),f.$utilShow.removeClass("active"),f.$addToListMenu.removeClass("active")},f.collectionUpdate=function(t,e){o(".r_tr."+t).toggleClass("collection",e).each(function(){var t;return t=o(this),w.updateStatus(t,{collection:e}),w.updateMasterRowSkittles(t)})},f.wantlistUpdate=function(t,e){o("tr.r_tr."+t).toggleClass("wantlist",e).each(function(){var t;return t=o(this),w.updateStatus(t,{wantlist:e}),w.updateMasterRowSkittles(t)})},f.toggleWantlist=function(){var t,e;return t=1===f.model.get("wantlist").length,e=t?"removeFrom":"addTo",f.model[e]("wantlist"),!1},f.addToWantlist=function(){return f.model.addTo("wantlist"),!1},f.addToCollection=function(){return f.model.addTo("collection"),!1},f.removeFromCollection=function(){return f.model.removeFrom("collection",o(this).closest(".cw_block_collection").data("id")),!1},f.toggleAllWantList=function(t){f.model.toggleAllWantlist(),t.preventDefault()},p=function(){c().then(d).then(function(){var t,e;return t=n(463),l&&(e=S.updateParams(window.location.href,{add:{filter:!0}}),window.history.replaceState(null,null,e)),t.init(),s.legacyTrack("master release","Opened master release filtering modal")})},v=function(){return o(".add_to_collection").on("click",function(){return h("google.legacyTrack","Optimistic Action","Clicked Add to Collection button")}),o(".toggle_wantlist").on("click",function(){return h("google.legacyTrack","Optimistic Action","Clicked Add to Wantlist button")}),o(".inv_add_button").on("click",function(){return h("google.legacyTrack","Optimistic Action","Clicked Sell Item button")})},b(function(){return f.init()}),g=function(t){var e,n,o;return e=t.id,o=t.property,n=m.cards.get(e),n&&n.addTo(o),k.remove("add-to-later")},t.exports=f},461:function(t,e,n){"use strict";var o=n(2),a=n(3),i=n(7),r=n(5),s=n(350),l=s.wantlist,c=s.collection,d=n(25),u=d.getText,m=n(13),h=n(318);n(342);var p=ds.require("alerts"),g=r.getUrl,f={SHARE:"broadcast_actions_share",SHARING:"broadcast_actions_sharing",UNSHARING:"broadcast_actions_unsharing",SHARED:"broadcast_actions_shared"},b={};b.init=function(){return l.on("sync",this.render,this),c.on("sync",this.render,this),b};var _=function(t){return p.alert(r.errorMessageFromXHR(t)),t},v=function(t,e){return function(n){return a.each(f,function(e){t.removeClass(e)}),t.addClass(e),n}};b.render=function(t,e){if(e.broadcast){var n=b.template(e.broadcast);h({message:n,type:"info",id:"cwBlockAdded",closable:!0}).$element.on("submit.broadcast",".broadcast_widget form",this.clickShare).on("click.broadcast",".broadcast_widget_undo",this.clickUndo)}},b.clickShare=function(t){var e=o(this).find(".broadcast_actions");v(e,f.SHARING)(),o.ajax({url:g("/broadcast/new"),type:"POST",data:o(this).serialize(),success:v(e,f.SHARED),error:v(e,f.SHARE)}).fail(_),t.preventDefault()},b.clickUndo=function(t){var e=o(this).parents("form"),n=e.find(".broadcast_actions");v(n,f.UNSHARING)(),o.ajax({url:g("/broadcast/delete"),type:"POST",data:e.serialize(),success:v(n,f.SHARE),error:v(n,f.SHARE)}).fail(_),t.preventDefault()},b.template=function(t){return t.templates={addedToYourCollection:u("Added %(title)s to your collection.")(t.preview),addedToYourWantlist:u("Added %(title)s to your wantlist.")(t.preview),share:u("Share")(),sharing:u("Sharing...")(),sharedOnYourProfile:u("Shared on your profile")(),undo:u("Undo")(),unsharing:u("Unsharing...")(),sharingSettings:u("Sharing Settings")()},t=a.extend(t,{userProfileUrl:g("/user/"+i.username),settingsPrivacyUrl:g("/settings/privacy")}),a.template('<div class="broadcast_widget" style="display: inline">         <form method="post" style="display: inline">         <input type="hidden" name="type" value="<%- type %>" />         <input type="hidden" name="object_id" value="<%- object_id %>" />         <input type="hidden" name="timestamp" value="<%- timestamp %>" />         <input type="hidden" name="signature" value="<%- signature %>" />         <% if (type === "add_collection") { %>         <strong><%= templates.addedToYourCollection %></strong>         <% } else if (type === "add_wantlist") { %>         <strong><%= templates.addedToYourWantlist %></strong>         <% } %>         <span class="broadcast_actions broadcast_actions_share">         <button class="broadcast_actions_share button button-green button-small"><i class="icon icon-bullhorn"></i> <%= templates.share %></button>         <span class="broadcast_actions_sharing"><button class="button button-small button-green" disabled="disabled"><i class="icon icon-spinner icon-spin"></i> <%= templates.sharing %></button></span>         <span class="broadcast_actions_shared"><a class="button button-green button-small" href="<%- userProfileUrl %>"><%= templates.sharedOnYourProfile %></a> <a href="#" class="button button-small button-red broadcast_widget_undo"><i class="icon icon-rotate-left"></i> <%= templates.undo %></a></span>         <span class="broadcast_actions_unsharing"><button class="button button-small button-green" disabled="disabled"><i class="icon icon-spinner icon-spin"></i> <%= templates.unsharing %></button></span>         </span>         <a class="button button-small needs_delegated_tooltip" href="<%- settingsPrivacyUrl %>" title="<%= templates.sharingSettings %>"><i class="icon icon-wrench"></i></a>         </form>         </div>')(t)},m(function(){return b.init()}),t.exports=b},463:function(t,e,n){var o,a,i,r,s,l,c,d,u,m,h,p,g,f,b,_,v;c=n(3),a=n(38),r=n(228),i=n(190),o=n(11),u=n(7),f=n(222),u=ds.require("dsdata"),h=ds.require("loadCSS"),l=r.Router,s=r.Route,d=r.browserHistory,v=void 0,_=void 0,g=!1,b={},m=function(){return v||(v=document.createElement("div"),document.getElementById("page").appendChild(v)),v},p=function(t,e){var a,i,r;return r=void 0,a=["components/react-modal.css","components/loading.css"],i=function(){return new o(function(t){return n.e(53,function(){return _=n(220),r=n(464),t()})})},g=o.all([f.load("search"),a.map(h),i()]).then(function(){return e(null,r)})},b={init:function(){return c.isElement(v)?g.then(function(){return _.showSearch()}):function(){var t,e,n;return e=u.locale===u.defaultLocale?"/":"/:locale",t=m(),n=a.createElement(s,{path:e},a.createElement(s,{path:"(:text/)master/(view/):masterId",getComponents:p})),i.render(a.createElement(l,{routes:n,history:d}),t)}()}},t.exports=b}});
//# sourceMappingURL=release.js.map